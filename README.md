# JDBC

```
Java Database Connectivity
자바에서 데이터베이스에 접속할 수 있도록 하는 자바 api
```

## LOW LEVEL JDBC API를 사용해서 h2 디비로 CRUD를 구현해본다.


### SQL MAPPER
```
JdbcTemplate
MyBatis
SQL 까지 작성해야함.
```

### ORM
```
JPA 
구현체 : 하이버네이트, 이클립스링크
개발 생산성이 높아진다.  쉬운 기술은 아니므로 깊이있게 학습해야 한다.
```

# Connection Pool
```
요청 때 마다 커넥션을 얻으면 tcp/ip 통신이 계속 이루어지고
디비 내부에서도 세션을 만들고 이런저런 작업 완료 후에 커넥션이 만들어진다.

커넥션풀은 커넥션을 미리 다 만들어 놓고 빌려주고 반납하는 것이다.
이미 다 연결된 상태 및 세션도 만들어진 상태이므로 sql 전달하는 부분부터 수행하면 된다. 
```

# DataSource
```
커넥션을 얻을 때 
DriverManager로 직접 얻기 또는 커넥션풀에서 얻을 수 있다.
잘 운영하다가 갑자기 커넥션 얻는 방식을 변경한다면 어플리케이션 소스단을 수정할 수 밖에 없다.

그래서 javax.sql.DataSource라는 인터페이스를 제공한다.
커넥션을 획득하는 방법을 추상화
이 인터페이스의 핵심 기능은 커넥션 조회 하나이다.

DriverManager는 DataSource를 구현하지 않았다.
하지만 DriverManagerDataSource 제공해준다.
```

# 트랜잭션 매니저
```
트랜잭션 매니저를 통해서 트랜잭션을 시작할 경우
트랜잭션 매니저가 커넥션을 얻고 트랜잭션 동기화 매니저에 커넥션을 넣어둔다.
같은 트랜잭션 일 경우 쓰레드로컬 기술로 같은 커넥션을 사용하여 같은 세션내 트랜잭션을 유지시킨다.
레파지토리는 트랜잭션 동기화 매니저에서 커넥션을 꺼내 쓰고 반납한다.
커밋 또는 롤백이 일어날 때 트랜잭션을 종료하고 트랜잭션 동기화 매니저에 있는 커넥션을 커넥션풀에 반납하는
정리하는 과정을 하며 끝난다. 
```

# @Transaction 
```
트랜잭션 어노테이션으로 서비스단에 있는 트랜잭션 코드를 모두 제거할 수 있다.
트랜잭션 어노테이션이 붙어 있으면 프록시 객체로 만들어 서비스 클래스를 대신 수행해준다.
트랜잭션 시작 > 수행 > 커밋 또는 롤백

선언적 트랜잭션 방식 이라 불림
직접 선언하는 것은 프로그래밍 트랜잭션 방식이다.( @Transaction 사용하지 않는 모든 것 )
```

# 스프링이 지원해주는 예외

```
각 벤더사의 데이터베이스 예외는 모두 다르다.
스프링은 이것을 통일성있게 제공해준다.
```

## DataAccessException
```
최상위 예외, 런타임 익셉션을 상속받았으므로 모두 unChecked 예외이다.
DataAccessException 은 크게 2가지로 구분하는데 NonTransient 예외와 Transient 예외이다.
```
 - Transient 는 일시적이라는 뜻이다. Transient 하위 예외는 동일한 SQL을 다시 시도했을 때 성공할 가능성이 있다.
예를 들어서 쿼리 타임아웃, 락과 관련된 오류들이다. 이런 오류들은 데이터베이스 상태가 좋아지거나, 
락이 풀렸을 때 다시 시도하면 성공할 수 도 있다.
 - NonTransient 는 일시적이지 않다는 뜻이다. 같은 SQL을 그대로 반복해서 실행하면 실패한다. 
 SQL 문법 오류, 데이터베이스 제약조건 위배 등이 있다. 
